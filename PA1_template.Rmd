---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
```{r, echo=F, message=F, warning=F}
library(dplyr)
library(ggplot2)
```

### Loading and preprocessing the data
1. Load the data
```{r}
    d <- read.csv("activity.csv", stringsAsFactors = FALSE)
```


2. Transform data (create a grouping by date and a grouping by interval)
```{r}
    g <- group_by(d, date)
    i <- group_by(d, interval)
```

### What is mean total number of steps taken per day?
1. Calculate the total number of steps per day
```{r}
    g <- summarize(g, sum(steps, na.rm = TRUE))
    names(g) <- c("date", "total_steps")
```


2. Make a histogram of the total number of steps per day
```{r}
    hist(g$total_steps, main = "Histogram of Total Steps", xlab = "Total Steps")
```


3. Calculate the mean and median of the total number of steps per day
```{r}
    mean(g$total_steps)
    median(g$total_steps)
```


## What is the average daily activity pattern?
1. Make a time series plot of the average steps per five min interval
```{r}
    i <- summarize(i, mean(steps, na.rm=TRUE))
    names(i) <- c("interval","avg_steps")
    plot(i$interval, i$avg_steps, type="l", xlab = "5-min Interval", ylab = "Avg Steps", main = "Avg Steps per Interval")
```


2. Which interval has the max number of steps?
```{r}
    subset(i, i$avg_steps==max(i$avg_steps))
```


### Imputing missing values
1. Calculate the total number of missing values in the dataset
```{r}
    sum(is.na(d$steps))
```    


2. Devise a strategy for filling in missing values

   * For each missing value, use the average for that interval across all days


3. Create a new dataset with missing values
```{r}
    n <- d
    # The single ifelse line seems to work, but I can't quite understand 
    #    how the proper interval from i is determined
    #
    # n$steps <- ifelse(is.na(n$steps), i$avg_steps, n$steps)
    #
    # Going with what I can understand :)
    for (idx in 1:nrow(n)) {
        if (is.na(n$steps[idx])) {
            n$steps[idx] <- i[i$interval==n$interval[idx],]$avg_steps
        } 
    }
```    


4. Make a histogram of the total number of steps per day with the new dataset
```{r}
    ng <- group_by(n, date)
    ng <- summarize(ng, sum(steps))
    names(ng) <- c("date", "total_steps")
    hist(ng$total_steps, main = "Histogram of Total Steps", xlab = "Total Steps") 
```    

   * Calculate the mean and median using the new dataset.
   
   * The mean and median are higher than the original dataset.  Because there are eight full days with missing values, total steps for that day is the mean for all days and the median ends up being the same as the mean.
```{r}
    mean(ng$total_steps)
    median(ng$total_steps)
```    
   
   
### Are there differences in activity patterns between weekdays and weekends?
1. Create a factor variable indicating weekend vs weekday
```{r}
    n$dow <- as.POSIXlt(n$date)$wday
    n$dowf <- factor(n$dow %in% 1:5, levels=c(FALSE,TRUE), labels = c("weekend","weekday"))
```


2. Make a panel plot containing a time series plot of the 5-minute interval and the average number of steps taken, averaged across all weekday days or weekend days.
```{r}
    nw <- group_by(n, dowf, interval)
    nw <- summarize(nw, mean(steps))
    names(nw) <- c("dowf","interval","avg_steps")
    p <- ggplot(nw, aes(x=interval, y=avg_steps)) 
    p <- p + geom_line() 
    p <- p + facet_wrap(~dowf, ncol=1)
    p <- p + labs(title="Avg Steps per Interval (Weekday vs Weekend)")
    p <- p + labs(x = "5-min Interval", y = "Avg Steps")
    print(p)
```    